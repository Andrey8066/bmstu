package com.buttondrug;

import javafx.animation.AnimationTimer;
import javafx.application.Application;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.layout.Pane;
import javafx.stage.Stage;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

public class App extends Application {

    private Pane root;
    private double START_SIZE = 50;
    private double MAX_SIZE = 120;
    public double SPEED = 3;

    private class MovingButton {
        Button button;
        double dx = SPEED;
        double dy = SPEED;

        public MovingButton(double x, double y, double size, int state) {
            button = new Button("Click!");
            button.setPrefSize(size, size);
            button.setLayoutX(x);
            button.setLayoutY(y);
            if (state==2)dx =-dx;
            if (state==4)dy =-dy;

            root.getChildren().add(button);
        }

        void move() {
            double x = button.getLayoutX();
            double y = button.getLayoutY();
            double width = button.getWidth();
            double height = button.getHeight();
            int state=0;
            boolean hitWall = false;
/*
            if (x + dx < 0 || x + width + dx > root.getWidth()) {
                dx = -dx;
                hitWall = true;
            }
            if (y + dy < 0 || y + height + dy > root.getHeight()) {
                dy = -dy;
                hitWall = true;
            }
*/
            if (x + dx < 0) 
            {
                dx = -dx;
                hitWall = true;
                state = 1;
            }
                if (x + width + dx > root.getWidth()) {
                    dx = -dx;
                    hitWall = true;
                    state = 2;
                }
                if (y + dy < 0){
                    dy = -dy;
                    hitWall = true;
                    state = 3;
                }
                if (y + height + dy > root.getWidth()) {
                    dy = -dy;
                    hitWall = true;
                    state = 4;
                }

            button.setLayoutX(x + dx);
            button.setLayoutY(y + dy);

            if (hitWall) {
                grow(state);
            }
        }

        void grow(int state) {
            System.out.println(state);
            double newSize = button.getWidth() + 10;
            if (newSize >= MAX_SIZE) {
                explode(state);
            } else {
                button.setPrefSize(newSize, newSize);
            }
        }

        void explode(int state) {
            root.getChildren().remove(button);
            buttons.remove(this);

            for (int i = 0; i < 4; i++) {
                double offsetX = -50;
                double offsetY = -50;

                MovingButton newBtn = new MovingButton(
                        button.getLayoutX() + 0,
                        button.getLayoutY() + 0,
                        START_SIZE,
                        state
                );
                buttons.add(newBtn);
            }
        }
    }

    private List<MovingButton> buttons = new ArrayList<>();
    private boolean started = false;

    @Override
    public void start(Stage primaryStage) {
        root = new Pane();
        Scene scene = new Scene(root, 600, 400);

        Button starter = new Button("Start!");
        starter.setPrefSize(START_SIZE, START_SIZE);
        starter.setLayoutX(275);
        starter.setLayoutY(175);
        root.getChildren().add(starter);

        starter.setOnAction(e -> {
            if (!started) {
                MovingButton mb = new MovingButton(starter.getLayoutX(), starter.getLayoutY(), START_SIZE, 1);
                buttons.add(mb);
                root.getChildren().remove(starter);
                started = true;
            }
        });

        AnimationTimer timer = new AnimationTimer() {
            @Override
            public void handle(long now) {
                for (Iterator<MovingButton> it = buttons.iterator(); it.hasNext(); ) {
                    MovingButton mb = it.next();
                    mb.move();
                }
            }
        };
        timer.start();

        primaryStage.setScene(scene);
        primaryStage.setTitle("Exploding Buttons");
        primaryStage.show();
    }

    public static void main(String[] args) {
        launch(args);
    }
}
